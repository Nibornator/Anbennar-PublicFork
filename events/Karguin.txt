namespace = karguin

# Info: 
# karguin.1 - fire by mission to open portal in province
# karguin.2 - passive waves on open portal, mtth
# karguin.3 - use on portal province, will spawn extra wave, hidden
# karguin.4 - effect of karguin.3, rebels on inidividual provinces
# karguin.11-15 - Events for each vassal tag spawning, fires in province scope so you can direct it at portal
# karguin.20 - Spawning support to vassal

# JELLY: Make sure to use province name in title!!!
# Portal opens
province_event = {
	id = karguin.1
	title = karguin.1.t
	desc = karguin.1.d
	picture = ANGRY_MOB_eventPicture
	
	is_triggered_only = yes
	major = yes

	immediate = {
		set_province_flag = portal_open
	}

	option = {
		name = karguin.1.a
		# JELLY: make tooltip about portal opening and invasion starting
		custom_tooltip = karguin_portal_open_tt
		hidden_effect = {
			for = {
				amount = 10
				effect = "
					random_province = {
						limit = {
							superregion = ROOT
							is_city = yes
							NOT = {
								OR = {
									owned_by = Y24
									owned_by = Y29
								}
							}
							NOT = { 
								owner = { 
									has_country_flag = reward_onyx_country
								}
							}
						}
						spawn_rebels = {
							type = tax_collectors_rebels_rebels
							size = 2
							culture = sun_elf
						}
					}
				"
			}
		}
	}
}

# Regular spawning, runs for each portal indepently
province_event = {
	id = karguin.2
	title = karguin.2.t
	desc = karguin.2.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	trigger = {
		has_province_flag = portal_open
	}

	immediate = {
		hidden_effect = {
			random_province = {
				limit = {
					superregion = ROOT
					is_city = yes
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
				}
	
				save_event_target_as = karguin_spawn_province
			}
		}
	}

	option = {
		name = karguin.2.a
		goto = karguin_spawn_province
		
		# JELLY: tooltip about regular wave going
		custom_tooltip = karguin_portal_wave_tt
		event_target:karguin_spawn_province = {
			spawn_rebels = {
				type = tax_collectors_rebels_rebels
				size = 2
				culture = sun_elf
			}
		}
	}
}

# Wave sent by karguin, bigger than normal
province_event = {
	id = karguin.3
	title = karguin.3.t
	desc = karguin.3.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes
	
	hidden = yes
	trigger = {
		has_province_flag = portal_open
	}

	option = {
		name = karguin.3.a
		
		for = {
			amount = 5
			effect = "
				random_province = {
					limit = {
						superregion = ROOT
						is_city = yes
						NOT = {
							OR = {
								owned_by = Y24
								owned_by = Y29
							}
						}
						NOT = { 
							owner = { 
								has_country_flag = reward_onyx_country
							}
						}
					}
					province_event = { id = karguin.4 }
				}
			"
		}
	}
}

# Wave by karguin - end provinces
province_event = {
	id = karguin.4
	title = karguin.4.t
	desc = gacha.4.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	option = {
		name = karguin.4
		
		# JELLY: tooltip about wave sent by the evil karguin!
		custom_tooltip = karguin_portal_wave_big_tt
		spawn_rebels = {
			type = tax_collectors_rebels_rebels
			size = 3
			culture = sun_elf
		}
	}
}

# Spawning - L77
province_event = {
	id = karguin.11
	title = karguin.11.t
	desc = gacha.11.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	immediate = {
		random_province = {
			limit = {
				superregion = ROOT
				is_city = yes
				owner = { ai = yes }
			}
		}

		save_event_target_as = spawning_point
		owner = { save_event_target_as = big_l_tag }
	}

	option = {
		name = karguin.11.a
		
		# JELLY: tooltip about invasion tag spawning
		custom_tooltip = karguin_vassal_spawn_tt
		hidden_effect = {
			event_target:spawning_point = {
				add_core = L77
				change_religion = infernal_court
				change_culture = sun_elf
				cede_province = L77
				L77 = {
					change_religion = infernal_court
					change_government = theocracy
					add_government_reform = secular_order_reform
					change_primary_culture = sun_elf
					add_country_modifier = {
						name = invasion_spawn_buff
						duration = -1
					}
					hidden_effect = {
						clear_racial_military = yes
						change_technology_group = tech_spirit
						change_unit_type = tech_spirit
						add_country_modifier = {
							name = spirit_military
							duration = -1
						}
						spirit_mil_shock_dmg = yes
					}
					karguin_starting_army = yes
					# custom ruler or whatev
				}
			}

			if = {
				limit = {
					event_target:big_l_tag = {
						exists = yes					
					}
				}

				L77 = {
					declare_war_with_cb = {
						who = event_target:big_l_tag
						casus_belli = cb_karguin
					}
				}
			}

			every_province = {
				limit = {
					superregion = ROOT
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
					is_city = yes
					owner = { ai = yes }
					NOT = { province_id = event_target:spawning_point }
				}
				add_core = L77
				change_culture = sun_elf
			}
		}
	}
}

# Spawning - S24
province_event = {
	id = karguin.12
	title = karguin.12.t
	desc = gacha.12.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	immediate = {
		random_province = {
			limit = {
				superregion = ROOT
				is_city = yes
				owner = { ai = yes }
			}
		}

		save_event_target_as = spawning_point
		owner = { save_event_target_as = big_l_tag }
	}

	option = {
		name = karguin.12.a
		
		# JELLY: tooltip about invasion tag spawning
		custom_tooltip = karguin_vassal_spawn_tt
		hidden_effect = {
			event_target:spawning_point = {
				add_core = S24
				change_religion = infernal_court
				change_culture = sun_elf
				cede_province = S24
				S24 = {
					change_government = theocracy
					add_government_reform = secular_order_reform
					change_religion = infernal_court
					change_primary_culture = sun_elf
					add_country_modifier = {
						name = invasion_spawn_buff
						duration = -1
					}
					hidden_effect = {
						clear_racial_military = yes
						change_technology_group = tech_spirit
						change_unit_type = tech_spirit
						add_country_modifier = {
							name = spirit_military
							duration = -1
						}
						spirit_mil_shock_dmg = yes
					}
					karguin_starting_army = yes
					# custom ruler or whatev
				}
			}

			if = {
				limit = {
					event_target:big_l_tag = {
						exists = yes					
					}
				}

				S24 = {
					declare_war_with_cb = {
						who = event_target:big_l_tag
						casus_belli = cb_karguin
					}
				}
			}

			every_province = {
				limit = {
					superregion = ROOT
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
					is_city = yes
					owner = { ai = yes }
					NOT = { province_id = event_target:spawning_point }
				}
				add_core = S24
				change_culture = sun_elf	
			}
		}
	}
}

# Spawning - S49
province_event = {
	id = karguin.13
	title = karguin.13.t
	desc = gacha.13.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	immediate = {
		random_province = {
			limit = {
				superregion = ROOT
				is_city = yes
				owner = { ai = yes }
			}
		}

		save_event_target_as = spawning_point
		owner = { save_event_target_as = big_l_tag }
	}

	option = {
		name = karguin.13.a
		
		# JELLY: tooltip about invasion tag spawning
		custom_tooltip = karguin_vassal_spawn_tt
		hidden_effect = {
			event_target:spawning_point = {
				add_core = S49
				change_religion = infernal_court
				change_culture = sun_elf
				cede_province = S49
				S49 = {
					change_government = theocracy
					add_government_reform = secular_order_reform
					change_religion = infernal_court
					change_primary_culture = sun_elf
					add_country_modifier = {
						name = invasion_spawn_buff
						duration = -1
					}
					hidden_effect = {
						clear_racial_military = yes
						change_technology_group = tech_spirit
						change_unit_type = tech_spirit
						add_country_modifier = {
							name = spirit_military
							duration = -1
						}
						spirit_mil_shock_dmg = yes
					}
					karguin_starting_army = yes
					# custom ruler or whatev
				}
			}

			if = {
				limit = {
					event_target:big_l_tag = {
						exists = yes					
					}
				}

				S49 = {
					declare_war_with_cb = {
						who = event_target:big_l_tag
						casus_belli = cb_karguin
					}
				}
			}

			every_province = {
				limit = {
					superregion = ROOT
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
					is_city = yes
					owner = { ai = yes }
					NOT = { province_id = event_target:spawning_point }
				}
				add_core = S49
				change_culture = sun_elf
			}
		}
	}
}

# Spawning - S48
province_event = {
	id = karguin.14
	title = karguin.14.t
	desc = gacha.14.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	immediate = {
		random_province = {
			limit = {
				superregion = ROOT
				is_city = yes
				owner = { ai = yes }
			}
		}

		save_event_target_as = spawning_point
		owner = { save_event_target_as = big_l_tag }
	}

	option = {
		name = karguin.14.a
		
		# JELLY: tooltip about invasion tag spawning
		custom_tooltip = karguin_vassal_spawn_tt
		hidden_effect = {
			event_target:spawning_point = {
				add_core = S48
				change_religion = infernal_court
				change_culture = sun_elf
				cede_province = S48
				S48 = {
					change_government = theocracy
					add_government_reform = secular_order_reform
					change_religion = infernal_court
					change_primary_culture = sun_elf
					add_country_modifier = {
						name = invasion_spawn_buff
						duration = -1
					}
					hidden_effect = {
						clear_racial_military = yes
						change_technology_group = tech_spirit
						change_unit_type = tech_spirit
						add_country_modifier = {
							name = spirit_military
							duration = -1
						}
						spirit_mil_shock_dmg = yes
					}
					karguin_starting_army = yes
					# custom ruler or whatev
				}
			}

			if = {
				limit = {
					event_target:big_l_tag = {
						exists = yes					
					}
				}

				S48 = {
					declare_war_with_cb = {
						who = event_target:big_l_tag
						casus_belli = cb_karguin
					}
				}
			}

			every_province = {
				limit = {
					superregion = ROOT
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
					is_city = yes
					owner = { ai = yes }
					NOT = { province_id = event_target:spawning_point }
				}
				add_core = S48
				change_culture = sun_elf	
			}
		}
	}
}

# Spawning - S45
province_event = {
	id = karguin.15
	title = karguin.15.t
	desc = gacha.15.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes

	immediate = {
		random_province = {
			limit = {
				superregion = ROOT
				is_city = yes
				owner = { ai = yes }
			}
		}

		save_event_target_as = spawning_point
		owner = { save_event_target_as = big_l_tag }
	}

	option = {
		name = karguin.15.a
		
		# JELLY: tooltip about invasion tag spawning
		custom_tooltip = karguin_vassal_spawn_tt
		hidden_effect = {
			event_target:spawning_point = {
				add_core = S45
				change_religion = infernal_court
				change_culture = sun_elf
				cede_province = Y24
				cede_province = S45
				S45 = {
					setup_vision = yes
					change_government = theocracy
					add_government_reform = secular_order_reform
					change_religion = infernal_court
					change_primary_culture = sun_elf
					add_country_modifier = {
						name = invasion_spawn_buff
						duration = -1
					}
					hidden_effect = {
						clear_racial_military = yes
						change_technology_group = tech_spirit
						change_unit_type = tech_spirit
						add_country_modifier = {
							name = spirit_military
							duration = -1
						}
						spirit_mil_shock_dmg = yes
					}
					karguin_starting_army = yes
					# custom ruler or whatev
				}
			}

			if = {
				limit = {
					event_target:big_l_tag = {
						exists = yes					
					}
				}

				S45 = {
					declare_war_with_cb = {
						who = event_target:big_l_tag
						casus_belli = cb_karguin
					}
				}
			}

			every_province = {
				limit = {
					superregion = ROOT
					NOT = {
						OR = {
							owned_by = Y24
							owned_by = Y29
						}
					}
					is_city = yes
					owner = { ai = yes }
					NOT = { province_id = event_target:spawning_point }
				}
				add_core = S45
				change_culture = sun_elf
			}
		}
	}
}

# Wave sent by karguin for vassal, 
country_event = {
	id = karguin.20
	title = karguin.20.t
	desc = gacha.20.d
	picture = ANGRY_MOB_eventPicture
	is_triggered_only = yes
	
	hidden = yes

	option = {
		name = karguin.3

		for = {
			amount = 5
			effect = "
				capital_scope = {
					random_province = {
						limit = {
							superregion = PREV
							owner = { 
								ai = yes
								NOT = { tag = ROOT } 
							}
						}
		
						spawn_rebels = {
							type = nyarguin_invasion_rebels
							size = 3
							separatists_target = ROOT
							culture = sun_elf
						}
					}
				}
			"
		}
	}
}

country_event = {
    id = karguin.100
    title = karguin.100.t
    desc = karguin.100.d
    picture = THE_COVENANT_eventPicture

    is_triggered_only = yes

    option = {    #we love satan
        name = karguin.100.a

        change_religion = infernal_court
        set_ruler_religion = infernal_court
        set_heir_religion = infernal_court

        add_stability = -1
        add_country_modifier = {
            name = black_converting_zeal
            duration = 1825
        }

        random_list = {
            1 = {
                add_country_modifier = {
                    name = black_the_eyes_and_the_ears
                    duration = 1825
                }
            }
            1 = {
                add_country_modifier = {
                    name = black_subjugated_artificery
                    duration = 1825
                }
            }
            1 = {
                add_country_modifier = {
                    name = black_mage_general
                    duration = 1825
                }
            }
        }
    }
    option = {    #y'all need jesus
        name = karguin.100.b

        # add gacha ticket here (idk the scripted effect)
    }
}

#Chosen Radiants
country_event = {
	id = karguin.202
	desc = karguin.202.d
	title = karguin.202.t
	picture = THE_COVENANT_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = karguin.202.a
		add_country_modifier = {
			name = celestial_knight_order_skybreakers
			duration = -1
		}
		add_years_of_income = 1
		add_yearly_manpower = 2
		hidden_effect = {
			apply_sprite_pack = celestial2_sprite_pack
		}
	}
}

country_event = {
	id = karguin.203
	desc = karguin.203.d
	title = karguin.203.t
	picture = THE_COVENANT_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = karguin.203.a
		add_country_modifier = {
			name = celestial_knight_order_windrunners
			duration = -1
		}
		add_years_of_income = 1
		add_yearly_manpower = 2
		hidden_effect = {
			apply_sprite_pack = celestial2_sprite_pack
		}
	}
}

country_event = {
	id = karguin.204
	desc = karguin.204.d
	title = karguin.204.t
	picture = THE_COVENANT_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = karguin.204.a
		add_country_modifier = {
			name = celestial_knight_order_dustbringers
			duration = -1
		}
		add_years_of_income = 1
		add_yearly_manpower = 2
		hidden_effect = {
			apply_sprite_pack = celestial2_sprite_pack
		}
	}
}

country_event = {
	id = karguin.205
	desc = karguin.205.d
	title = karguin.205.t
	picture = THE_COVENANT_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = karguin.205.a
		add_country_modifier = {
			name = celestial_knight_order_stonewards
			duration = -1
		}
		add_years_of_income = 1
		add_yearly_manpower = 2
		hidden_effect = {
			apply_sprite_pack = celestial2_sprite_pack
		}
	}
}

country_event = {
	id = karguin.206
	desc = karguin.206.d
	title = karguin.206.t
	picture = THE_COVENANT_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = karguin.206.a
		add_country_modifier = {
			name = celestial_knight_order_edgedancers
			duration = -1
		}
		add_years_of_income = 1
		add_yearly_manpower = 2
		hidden_effect = {
			apply_sprite_pack = celestial2_sprite_pack
		}
	}
}